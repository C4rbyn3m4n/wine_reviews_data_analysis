---
title: "Preprcessing"
output: html_notebook
---
Import Libraries
```{r}
library("tidyverse")
library("dplyr")
```

Read dataset_1 - Note: Removed first column for ID values
```{r}
dataset_1 <- read.csv("../raw_data/dataset_1/winemag-data-130k-v2.csv")[-1]
```

Combine all the csv files for dataset_2
```{r}
# function reads csv values
readfile <- function(filename){
  cat("Reading file: ", filename, "...\n", sep = '' )
  return(read.csv(file = filename, header = TRUE))
}

# function merges two dataframes together
merge_dataframes <- function(dataframe_1, dataframe_2){
  return(rbind(dataframe_1, dataframe_2))
}

# funciton merges all csv files in folder to one dataframe
combine_data = function(mypath){
  filenames=list.files(path=mypath, full.names=TRUE)
  datalist = lapply(filenames, function(x) readfile(x))
  return(Reduce(f = function(x,y) merge_dataframes(x,y), x = datalist, accumulate = FALSE))
}

dataset_2 <- combine_data("../raw_data/dataset_2")
```

Join datasets by `title`,  `description`, `price`, `country`, `points` = `rating`
```{r}
join_wines <- inner_join(dataset_1, dataset_2, by = c("title", "description", "points" = "rating", "price", "country"))
```

Visualize Joined data
```{r}
head(join_wines)
```

Output uncleaned joined data for others to use
```{r}
write_csv(join_wines, "joined_datasets.csv")
```

Clean joined data to remove redundancies
```{r}
join_wines_cleaned <- join_wines %>%
  select(country, description, designation=designation.x, points, price, province, region=region_1, subregion=region_2, taster_name, taster_twitter_handle, title, variety, winery=winery.x, alcohol, category, url, vintage)
head(join_wines_cleaned)
```

Outout cleaned joined data for others to use
```{r}
write_csv(join_wines_cleaned, "joined_datasets_cleaned.csv")
```

Extract relevant information for our use
```{r}
wines <- join_wines_cleaned %>%
  select(title, alcohol, category, vintage, designation, country, province, region, subregion,  variety, winery, price, points, taster_name, taster_twitter_handle)
```

Output for easy import later
```{r}
write_csv(wines, "wines.csv")
```



